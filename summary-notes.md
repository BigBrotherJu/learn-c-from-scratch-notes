# 全书总结

## 重要的概念

- [C 语言标准](part-1/chapter-2.md#C-语言标准)
- [组合](part-1/chapter-2.md#目前学过的语法规则)
- [Side Effects](part-1/chapter-3.md#Side-Effects)
- [函数和过程](part-1/chapter-3.md#自定义函数语法规则)
- [Rule of Lease Surprise](part-1/chapter-3.md#带参数函数的定义和声明)
- [Rationale](part-1/chapter-3.md#带参数函数的定义和声明)
- [函数也叫接口](part-1/chapter-3.md#形参和实参)
- [Man Page](part-1/chapter-3.md#Man-Pages)
- [谓词](part-1/chapter-4.md#谓词)
- [代码路径、Dead Code](part-1/chapter-5.md#代码路径和-dead-code)
- [增量式开发](part-1/chapter-5.md#增量式开发)
- [手脚架](part-1/chapter-5.md#手脚架)
- [复用代码](part-1/chapter-5.md#复用代码，避免重复写代码)
- [函数的分层设计](part-1/chapter-5.md#函数的分层设计)
- [Leap of Faith](part-1/chapter-5.md#递归函数)
- [完备的 C 语言子集](part-1/chapter-5.md#目前学到的语法已经完备)
- [函数式编程和命令式编程](part-1/chapter-6.md#比较递归和循环)
- [goto 语句的危害](part-1/chapter-6.md#goto-语句)
- [学习编程语言时要注意的三方面](part-1/chapter-7.md#学习编程语言时要注意的三个方面)
- [数据抽象和抽象层](part-1/chapter-7.md#数据抽象)
- [硬编码](part-1/chapter-8.md#硬编码)
- [Epoch](part-1/chapter-8.md#8.3-数组应用实例：直方图)
- [Row-Major and Column-Major](part-1/chapter-8.md#初始化二维数组)
- [数据驱动的编程](part-1/chapter-8.md#数据驱动的编程)
- [代码是写给人看的](part-1/chapter-9.md#9.-编码风格)
- [UNIX 标准字符终端长宽](part-1/chapter-9.md#9.-编码风格)
- [Loop Invariant](part-1/chapter-10.md#11.2-插入排序)
- [Design by Contract](part-1/chapter-10.md#11.6-折半查找)
- [断言](part-1/chapter-10.md#11.6-折半查找)

## 源代码组成

### 函数体外

- 声明

  > 语句只能出现在函数体中，而声明既可以出现在函数体中也可以出现在所有函数之外。

  - 变量定义（变量初始化）

    > 与局部变量的概念相对的是全局变量（Global Variable），全局变量定义在所有的函数体之外。

    全局变量只能用常量表达式（由常量组成的表达式）来初始化。

    如果全局变量在定义时不初始化则初始值是0。

  - 函数声明、函数定义

  - 类型声明

- 预处理指令

  - `#include`
  - `#define`

### 函数体内

#### 声明

- 变量定义（变量初始化）

  > 我们把函数中定义的变量称为局部变量（Local Variable）。

  局部变量可以用类型相符的任意表达式来初始化。

  如果局部变量在定义时不初始化则初始值是不确定的。

- 函数声明

- 函数定义是否可以存在

  > 虽然在一个函数体中可以声明另一个函数，但不能定义另一个函数，C语言不允许嵌套定义函数。
  >
  > 但gcc的扩展特性允许嵌套定义函数，本书不做详细讨论。

- 类型声明

#### 语句

任何允许出现语句的地方可以出现：由 ; 结尾的一条语句；也可以是由{}括起来的若干条语句或声明组成的语句块，语句块和函数体的语法相同；也可以是单独 ; 表示的空语句。

标号后面可以跟单条语句、语句块、空语句，但是不能跟声明，可以把声明放在{}中或者在声明前面加一个 ;。标号除了可以随意写外，还可以是 `case 整型常量表达式:` 和 `default:`。一条语句前面可以有多个标号。

- 表达式语句

  > 在任意表达式后面加个;号也是一种语句，称为表达式语句。

  - 表达式

    - 运算符

      [运算符注意事项](#运算符注意事项)

      - 后缀运算符 左结合

        函数调用运算符 () 后缀自增运算符 ++ 后缀自减运算符 -- 结构体取成员运算符 . 数组取下标运算符 []

      - 单目运算符 右结合

        逻辑非运算符 ! 正号运算符 + 负号运算符 - 前缀自增运算符 ++ 前缀自减运算符 --

      - 乘除运算符 左结合

        乘法运算符 \* 除法运算符 / 取模运算符 %

      - 加减运算符 左结合

        加法运算符 \+ 减法运算符 -

      - 关系运算符 左结合

        \> < >= <=

      - 相等性运算符 左结合

        == !=

      - 逻辑与运算符 左结合

        &&

      - 逻辑或运算符 左结合

        ||

      - 赋值运算符 右结合

        =

    - [类型](#类型（Type）)

      > 任何表达式都有**值**和**类型**两个基本属性。

- 改变控制流程的语句

  控制流程的表达式就是控制表达式。

  - 跳转

    - break 语句

    - continue 语句

    - goto 语句

      goto 语句和标号配合，可以在一个函数内实现无条件跳转。

  - 分支

    - if/else 语句

      if/else 中可以用单条语句、语句块、空语句。

      else 子句可以省略。

    - [switch 语句](#switch-语句)

      switch 的语句块就是一个正常的语句块，可以有声明和语句。特殊的是 switch 语句块中语句前面的标号可以是 `case 整型常量表达式:` 和 `default:`。

  - 循环

    - while 语句

      while 中可以用单条语句、语句块、空语句。

    - do/while 语句

      do/while 中可以用单条语句、语句块、空语句。

    - for 语句

      for 中可以用单条语句、语句块、空语句。

      如果控制表达式 2 为空，则认为控制表达式2的值为真。

      C99 规定了在控制表达式 1 的位置可以有变量定义。如果这样定义，那么这个变量只是 for 循环中的局部变量而不是整个函数的局部变量。

- return 语句

#### 运算符注意事项

- 除法运算符操作数为两个整数时的结果

  两个整数相除结果无论是正是负，总是把小数部分截掉。

- 取模运算符的操作数和结果符号

  % 运算符的两个操作数必须是整型的。

  % 运算符的结果总是与被除数同号。

- 关系运算符和相等性运算符的操作数

  这些运算符的两个操作数应该是相同类型的，两边都是整型或者都是浮点型可以做比较，但两个字符串不能做比较。

  浮点型因为精度问题，不适合用 == 运算符做精确比较。

- 赋值运算符左边的操作数（左值）

  只有变量、数组取下标表达式可以做左值。

  函数调用表达式不能做左值。

  由 . 后缀运算符组成的表达式能不能做左值取决于 . 后缀运算符左边的操作数能不能做左值。

#### 类型（Type）

- 类型种类

  - 标量（Scalar）类型

    - 算术（Arithmetic）类型

      - 整数（Integer）类型

        - `int`，整数（Integer）类型

          - 布尔类型

            如果一个表达式要产生一个代表真假的值，那就两种情况，1 代表真，0 代表假。

            如果某条语句要检查一个表达式是真是假，非 0 代表真，0 代表假。

        - `char`，字符（Character）类型

        - `enum tag` 枚举（Enumeration）类型

      - 浮点数（Floating Point）类型

        - 单精度浮点数类型

          `float`

        - 双精度浮点数类型

          `double`

        - 精度更高的浮点数类型

          `long double`

    - 指针类型

  - 函数类型（Function Type）

- 类型大小

  > 在C语言中char型变量占一个字节，其他类型的变量占多少字节在不同平台上有不同的规定。

#### switch 语句

- 格式要求

  - case 分支

    - case 后面要跟常量表达式

      > case后面跟的表达式必须是常量表达式，这个值和全局变量的初始值一样必须在**编译时计算出来**。

    - case 后面跟的常量表达式还要是整型的

      > 第4.2节讲过浮点型不适合做精确比较，所以C语言规定case后面跟的必须是整型常量表达式。

    - 每个 case 后面跟的常量表达式必须互不相同

      > C语言规定各case分支的常量表达式必须互不相同。

  - default 分支

    - default 分支可以有，可以没有

    - default 分支通常写在最后，但也可以写在开头和中间

  - break 语句

    case 分支对应的语句和 default 分支对应的语句中可以有 break 语句，也可以没有。

- 执行流程

  将控制表达式和所有 case 分支的整型常量表达式进行比较。

  如果有一个（最多只能有一个，因为每个 case 分支的表达式互不相同）case 分支匹配上了，那么执行该 case 分支后面的语句和声明。

  如果没有 case 分支匹配上，再看有没有 default 分支。如果有 default 分支，执行对应的语句和声明。如果没有 default 分支，则跳过 switch 语句。

  在执行 case 分支和 default 分支对应的语句和声明时，除非遇到 break 语句或者执行到 switch 语句的末尾，否则一直往下执行，即使执行到其他 case 分支或 default 分支对应的语句和声明。如果遇到了 break 语句，那么跳出 switch 语句，执行后面的语句。

## GCC 使用

### C 标准

选项-std=c99。

### 从源代码到可执行文件的整个过程

一个 C 源代码文件要先被编译器翻译成汇编程序，再被汇编器翻译成机器指令，最后还要经过链接器的处理才能成为可执行文件。

编译器的工作分为两个阶段，先是预处理（Preprocess）阶段，然后才是编译阶段。

- 预处理阶段

  预处理器将源代码中的预处理指令进行预处理。

  - #include

    - 包含的头文件位置

      头文件通常位于/usr/include目录。

  - 处理之后的源代码

    可以用这两种方式查看预处理之后的源代码；

    - `$gcc -E main.c`

    - `$cpp main.c`

      cpp 是 C preprocessor 的意思。

- 编译阶段

  - 让 GCC 提示所有警告信息

    在使用 GCC 编译的时候加上 `-Wall` 选项。

- 链接阶段

  - `-l` 选项

    链接库文件时，需要根据库文件文件名用相应的选项执行 GCC。如链接 `libm.so`，命令为 `$gcc main.c -lm`。`-lc` 不用加上，这是 GCC 默认选项。

- 可执行文件

  - 默认的可执行文件名 `a.out`

    `a.out` 是 Assembler Output 的缩写。

  - 改变可执行文件名

    `$ gcc main.c -o main`

### 编译、汇编、链接

> 总结一下编译执行的过程，首先你用文本编辑器写一个C程序，然后保存成一个文件，例如program.c（通常C程序的文件名后缀是.c），这称为源代码（Source Code）或源文件，然后运行编译器对它进行编译，编译的过程并不执行程序，而是把源代码全部翻译成机器指令，再加上一些描述信息，生成一个新的文件，例如a.out，这称为可执行文件，可执行文件可以被操作系统加载运行，计算机执行该文件中由编译器生成的指令，如图1.1所示。

描述信息是什么？

## Bash

`$?`

## 常量（Constant）

- 字符常量
- 整数常量
- 浮点数常量

  3.14 是 `double` 类型的。

- 枚举常量

## 转义序列

转义序列有以下两类：

- C 标准规定的转义字符

  ![转义字符](part-1/images/转义字符.png)

- ASCII 码转义序列

  > 这种转义序列由\加上1～3个八进制数字组成，或者由\x加上1～2个十六进制数字组成，可以用在**字符常量**或**字符串字面值**中。

注意事项：

- 在字符串字面值中表示 \、" 必须使用转义序列
- 在字符常量中表示 \、' 必须使用转义序列
