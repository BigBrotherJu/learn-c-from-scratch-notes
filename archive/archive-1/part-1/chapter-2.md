# 2. 常量、变量和表达式

## 2.1 继续 Hello World

### 注释 2.1

- `/* */` 2.1

  这种注释可以跨行，也可以穿插在程序之中。

  ``` c
  #include <stdio.h>

  /*
   * comment1
   * main: generate some simple output
   */

  int main(void)
  {
      printf(/* comment2 */"Hello, world.\n"); /* comment3 */
      return 0;
  }
  ```

  遇到一个 `/*`，编译器就会寻找一个 `*/`，并把中间内容当作注释忽略。所以嵌套的注释如 `/* text1 /* text2 */ text3 */` 是错误的，编译器只把 `/* text1 /* text2 */` 看成注释，后面的 `text3 */` 无法解析，因而会报错。

- `//` 2.1

  有的 C 代码中有类似 `// comment` 的注释，两个 `/` 斜线（Slash）表示从这里直到该行末尾的所有字符都属于注释，这种注释不能跨行，也不能穿插在一行代码中间。

  这是从 C++ 借鉴的语法，在 C99 中被标准化。

### C 语言标准 2.1

C 语言的发展历史大致上分为三个阶段：Old Style C、C89 和 C99。Ken Thompson 和 Dennis Ritchie 最初发明 C 语言时有很多语法和现在最常用的写法并不一样，但为了向后兼容性（Backward Compatibility），这些语法仍然在 C89 和 C99 中保留下来了，本书不详细讲 Old Style C，但在必要的地方会加以说明。

- C89 2.1

  C89 是最早的 C 语言规范，于 1989 年提出，1990 年首先由 ANSI（美国国家标准委员会，American National Standards Institute）推出，后来被接纳为 ISO 国际标准（ISO/IEC 9899:1990），因而有时也称为 C90，最经典的 C 语言教材 K&R 就是基于这个版本的，C89 是目前最广泛采用的 C 语言标准，大多数编译器都完全支持 C89。

- C99 2.1

  C99 标准（ISO/IEC 9899:1999）是在 1999 年推出的，加入了许多新特性，但目前仍没有得到广泛支持，在 C99 推出之后相当长的一段时间里，连 gcc 也没有完全实现 C99 的所有特性。C99 标准详见 C99。

- 理解 C 标准 2.1

  C 标准的目的是为了精确定义 C 语言，而不是为了教别人怎么编程，C 标准在表达上追求准确和无歧义，却十分不容易看懂，Standard C 和 Standard C Library 是对 C89 及其修订版本的阐释（可惜作者没有随 C99 更新这两本书），比 C 标准更容易看懂，另外，参考 C99 Rationale 也有助于加深对 C 标准的理解。

### 字符串 2.1

- 字符串字面值 2.1

  像 `"Hello, world.\n"` 这种由双引号（Double Quote）引起来的一串字符称为字符串字面值（String Literal），或者简称字符串。

  注意，程序的运行结果并没有双引号，`printf` 打印出来的只是里面的一串字符 `Hello, world.`，因此双引号是字符串字面值的**界定符**，夹在双引号中间的一串字符才是它的内容。

- 转义序列（Escape Sequence）2.1

  ![转义字符](image/转义字符.png)

  - 普通字符和特殊字符 2.1

    如果在字符串字面值中要表示单引号和问号，既可以使用转义序列 `\'` 和 `\?`，也可以直接用字符 `'` 和 `?`，而要表示 `\` 或 `"` 则必须使用转义序列，因为 `\` 字符表示转义而不表示它的字面含义，`"` 表示字符串的界定符而不表示它的字面含义。

    可见转义序列有两个作用：一是把普通字符转义成特殊字符，例如把字母 `n` 转义成换行符；二是把特殊字符转义成普通字符，例如 `\` 和 `"` 是特殊字符，转义后取它的字面值。

    - `\?` 2.2

      读者可能会奇怪，为什么需要规定一个转义序列 `\?` 呢？因为 C 语言规定了一些三连符（Trigraph），在某些特殊的终端上缺少某些字符，需要用 Trigraph 输入，例如用 `??=` 表示 `#` 字符。

      Trigraph 极不常用，介绍这个只是为了让读者理解 C 语言规定转义序列的作用，即特殊字符转普通字符，普通字符转特殊字符，`?` 也是一种特殊字符。极不常用的 C 语法在本书中通常不会介绍。

  - 控制字符 2.1

    C 语言规定了几个控制字符，不能用键盘直接输入，因此采用 `\` 加字母的转义序列表示。

    - `\a`

      `\a` 是响铃字符，在字符终端下显示这个字符的效果是 PC 喇叭发出嘀的一声，在图形界面终端下的效果取决于终端的实现。

    - `\b`

      在终端下显示 `\b` 和按下退格键的效果相同。

    - `\f`

      `\f` 是分页符，主要用于控制打印机在打印源代码时提前分页，这样可以避免一个函数跨两页打印。

    - `\n` 和 `\r`

      `\n` 和 `\r` 分别表示 Line Feed 和 Carriage Return，这两个词来自老式的英文打字机，Line Feed 是跳到下一行（进纸，喂纸，有个喂的动作所以是feed），Carriage Return 是回到本行开头（Carriage 是卷着纸的轴，随着打字慢慢左移，打完一行就一下子移回最右边），如果你看过欧美的老电影应该能想起来这是什么。

      用老式打字机打完一行之后需要这么两个动作，`\r\n`，所以现在 Windows 上的文本文件用 `\r\n` 做行分隔符，许多应用层网络协议（如 HTTP）也用 `\r\n` 做行分隔符，而 Linux 和各种 UNIX 上的文本文件只用 `\n` 做行分隔符。

    - `\t` 和 `-v`

      在终端下显示 `\t` 和按下 Tab 键的效果相同，用于在终端下定位表格的下一列，`\v` 用于在终端下定位表格的下一行。`\v`比较少用，`\t` 比较常用。

      以后将「水平制表符」简称为「制表符」或 Tab。

### 代码风格注意 2.1

``` c
#include <stdio.h>

/* main: generate some simple output */

int main(void)
{
    printf("Hello, world.\n");
    return 0;
}
```

程序中的空格和 Tab 多一个少一个往往是无关紧要的，不会对编译的结果产生任何影响，例如不缩进不会影响程序的结果，`main` 后面多几个空格也没影响，但是 `int` 和 `main` 之间至少要有一个空格分隔开：

``` c
int main    (void)
{
printf("Hello, world.\n");
return 0;
}
```

不仅空格和 Tab 是无关紧要的，换行也是如此，我甚至可以把整个程序写成一行，但是 `include` 必须**单独占一行**：

``` c
#include<stdio.h>
int main(void){printf("Hello, world.\n");return 0;}
```

## 2.2 常量

### 常量（Constant）2.2

常量（Constant）是程序中最基本的元素，有字符（Character）常量、整数（Integer）常量、浮点数（Floating Point）常量和枚举常量。

下面看一个例子：

``` c
printf("character: %c\ninteger: %d\nfloating point: %f\n", '}', 34, 3.14);
```

- 字符常量 2.2

  字符常量要用单引号括起来，例如上面的 `'}'`，注意单引号只能括**一个字符**而不能像双引号那样括一串字符，字符常量也可以是一个转义序列，例如 `'\n'`，这时虽然单引号括了两个字符，但实际上只表示一个字符。

  和字符串字面值中使用转义序列有一点区别，如果在字符常量中要表示双引号 `"` 和问号 `?`，既可以使用转义序列 `\"` 和 `\?`，也可以直接用字符 `"` 和 `?`，而要表示 `'` 和 `\` 则必须使用转义序列。

- ASCII 码转义序列 2.6

  字符也可以用 ASCII 码转义序列表示，这种转义序列由 `\` 加上 1~3 个八进制数字组成，或者由 `\x` 或大写 `\X` 加上 1~2 个十六进制数字组成，可以用在字符常量或字符串字面值中。

  例如 `'\0'` 表示 NUL 字符（Null Character），`'\11'`或 `'\x9'` 表示 Tab 字符，`"\11"` 或 `"\x9"` 表示由 Tab 字符组成的字符串。

  注意 `'0'` 的 ASCII 码是 48，而 `'\0'` 的 ASCII 码是 0，两者是不同的。

- 空白字符（Whitespace）2.6

  空白字符在不同的上下文中有不同的含义，在 C 语言中空白字符定义为空格、水平 Tab、垂直 Tab、换行和分页符。

### `printf` 2.2

`printf` 中的第一个字符串称为格式化字符串（Format String），它规定了后面几个**常量**以何种格式插入到这个字符串中，在格式化字符串中 `%` 号（Percent Sign）后面加上字母 `c`、`d`、`f` 分别表示字符型、整型和浮点型的转换说明（Conversion Specification），转换说明只在格式化字符串中占个位置，并不出现在最终的打印结果中，这种用法通常叫做占位符（Placeholder）。

- 转换说明和转义序列 2.2

  这也是一种字面意思与真实意思不同的情况，但是转换说明和转义序列又有区别：转义序列是**编译时**处理的，而转换说明是在运行时调用 `printf` 函数处理的。

## 2.3 变量

### 声明和定义 2.3

- 三种声明

  C 语言中的声明（Declaration）有**变量**声明、**函数**声明和**类型**声明三种。

- 定义是声明的一种

  如果一个变量或函数的声明要求编译器为它分配存储空间，那么也可以称为定义（Definition），因此定义是声明的一种。

- 变量定义和变量声明

  在接下来几章的示例代码中变量声明都是要分配存储空间的，因而都是定义，等学到第 2 节「定义和声明」我们会看到哪些变量声明不分配存储空间因而不是定义。

- 函数定义和函数声明

  在下一章我们会看到函数的定义和声明也是这样区分的，分配存储空间的函数声明可以称为函数定义。

- 类型定义和类型声明

  从第 7 章 结构体开始我们会看到类型声明，声明一个类型是不分配存储空间的，但似乎叫「类型定义」听起来也不错，所以在本书中「类型定义」和「类型声明」表示相同的含义。

- **声明和语句的区别**

  声明和语句类似，也是以 `;` 号结尾的，但是在语法上声明和语句是有区别的，语句只能出现在 `{}` 括号中，而声明既可以出现在 `{}` 中也可以出现在所有 `{}` 之外。

- 相同类型变量可以一起声明

  ``` c
  int hour, minute;
  ```

### 类型（Type）2.3

字符型、整型、浮点型。

浮点型有三种，`float` 是单精度浮点型，`double` 是双精度浮点型，`long double` 是精度更高的浮点型。

常量 `3.14` 应该看作 `double` 类型的常量，`printf` 的 `%f` 也应该看作 `double` 型的转换说明。

- 两个 `int` 相除还是 `int`，截掉小数 2.5

  ``` c
  hour = 11;
  minute = 59;
  printf("%d and %d hours\n", hour, minute / 60);
  ```

  执行结果是 `11 and 0 hours`，也就是说 59/60 得 0，这是因为两个 `int` 型操作数相除的表达式仍为 `int` 型，只能保存计算结果的整数部分，即使小数部分是 0.98 也要舍去。

  在 C 语言中整数除法取的既不是 Floor 也不是 Ceiling，无论操作数是正是负总是把小数部分截掉，在数轴上向零的方向取整（Truncate toward Zero），或者说当操作数为正的时候相当于 Floor，当操作符为负的时候相当于 Ceiling。

- 不同类型变量所占字节 2.4

  变量的最小存储单位是字节（Byte），在 C 语言中 `char` 型变量占一个字节，其它类型的变量占多少字节在不同平台上有不同的规定。

- 字符类型也可以当作整数 2.6

  字符常量或字符型变量也可以当作整数参与运算，例如：

  ``` c
  printf("%c\n", 'a'+1);
  ```

  执行结果是 `b`。

  现在我们知道 `char` 型本质上就是整数，只不过取值范围比 `int` 型小，所以以后我们把 `char` 型和 `int` 型统称为整数类型（Integer Type）或简称整型，以后我们还要学习几种类型也属于整型。

### 变量名/标识符起名限制 2.3

给变量起名有一定的限制，C 语言规定必须以字母或下划线 `_`（Underscore）开头，后面可以跟若干个字母、数字、下划线，但不能有其它字符。

例如这些是合法的变量名：`Abc`、`__abc__`、`_123`。

但这些是不合法的变量名：`3abc`、`ab$`。

其实这个规则不仅适用于变量名，也适用于所有可以由程序员起名的语法元素，例如以后要讲的函数名、宏定义、结构体成员名等，在 C 语言中这些统称为标识符（Identifier）。

还有一点要注意，一般来说应避免使用以下划线开头的标识符，以下划线开头的标识符只要不和 C 语言关键字冲突的都是合法的，但是往往被编译器用作一些功能扩展，C 标准库也定义了很多以下划线开头的标识符，所以除非你对编译器和 C 标准库特别清楚，一般应避免使用这种标识符，以免造成命名冲突。

### 关键字（Keyword）或保留字（Reserved Word）2.3

另外要注意，表示类型的 `char`、`int`、`float`、`double` 等虽然符合上述规则，但也不能用作标识符。

在 C 语言中有些单词有特殊意义，不允许用作标识符，这些单词称为关键字（Keyword）或保留字（Reserved Word）。通常用于编程的文本编辑器都会高亮显示（Highlight）这些关键字，所以只要小心一点通常不会误用作标识符。

C99 规定的关键字有：

```
auto  break  case  char  const  continue  default  do  double
else  enum  extern  float  for  goto  if  inline  int  long
register  restrict  return  short  signed  sizeof  static  struct  switch  typedef
union  unsigned  void  volatile  while  _Bool  _Complex  _Imaginary
```

## 2.4 赋值

### 赋值（Assignment）语句 2.4

定义了变量之后，我们要把值存到它们所表示的存储空间里，可以用赋值（Assignment）语句实现。

注意变量一定要先声明后使用，编译器必须先看到变量声明，才知道 `firstletter`、`hour` 和 `minute` 是变量名，各自代表一块存储空间。另外，变量声明中的类型表明这个变量代表多大的一块存储空间，这样编译器才知道如何读写这块存储空间。

### 初始化（Initialization）2.4

变量的定义和赋值也可以一步完成，这称为变量的初始化（Initialization）。

``` c
char firstletter = 'a';
int hour = 11, minute = 59;
```

在初始化语句中，等号右边的值叫做 Initializer，例如上面的 `'a'`、`11` 和 `59`。

注意，初始化是一种特殊的声明，而不是一种赋值语句。

就目前来看，先定义一个变量再给它赋值和定义这个变量的同时给它初始化所达到的效果是一样的，C 语言的很多语法规则既适用于赋值也适用于初始化，但在以后的学习中你也会了解到**它们之间的不同**，请在学习过程中注意总结赋值和初始化的相同和不同之处。

## 2.5 表达式

### 表达式（Expression）2.5

- 表达式由运算符和操作数组成 2.5

  常量和变量都可以参与加减乘除运算，例如 `1+1`、`hour-1`、`hour * 60 + minute`、`minute/60` 等。

  这里的 `+` `-` `*` `/` 称为运算符（Operator），而参与运算的常量和变量称为操作数（Operand），上面四个由运算符和操作数所组成的算式称为表达式（Expression）。

- 运算符优先级（Precedence）2.5

  `*` 和 `/` 是同一优先级，`+` 和 `-` 是同一优先级，`*` 和 `/` 的优先级高于 `+` 和 `-`。

  对于同一优先级的运算从左到右计算，如果不希望按默认的优先级计算则要加 `()` 括号（Parenthesis）。

- 表达式语句 2.5

  前面讲过打印语句和赋值语句，现在我们定义：在任意表达式后面加个 `;` 号也是一种语句，称为表达式语句。例如：

  ``` c
  hour * 60 + minute;
  ```

  这是个合法的语句，但这个语句在程序中起不到任何作用，把 `hour` 的值和 `minute` 的值取出来加乘，得到的计算结果却没有保存，白算了一通。

- 赋值运算符、赋值表达式和赋值语句 2.5

  再比如：

  ``` c
  int total_minute;
  total_minute = hour * 60 + minute;
  ```

  这个语句就很有意义，把计算结果保存在另一个变量 `total_minute` 里。

  事实上等号也是一种运算符，称为赋值运算符，赋值语句就是一种表达式语句，等号的优先级比 `+` 和 `*` 都低，所以先算出等号右边的结果然后才做赋值操作，整个表达式 `total_minute = hour * 60 + minute` 加个 `;` 号构成一个语句。

- 表达式的基本属性 2.5

  任何表达式都有**值**和**类型**两个基本属性。

  `hour * 60 + minute` 的值是由三个 `int` 型的操作数计算出来的，所以这个表达式的类型也是 `int` 型。

  同理，表达式 `total_minute = hour * 60 + minute` 的类型也是 `int`，它的值是多少呢？C 语言规定赋值运算符的计算结果就是等号左边被赋予的那个值，所以这个表达式的值和 `hour * 60 + minute` 的值相同，也和 `total_minute` 的值相同。

- 运算符的结合性（Associativity）2.5

  赋值运算符还有一个和 `+` `-` `*` `/` 不同的特性，如果一个表达式中出现多个等号，不是从左到右计算而是从右到左计算，例如：

  ``` c
  int total_minute, total;
  total = total_minute = hour * 60 + minute;
  ```

  计算顺序是先算 `hour * 60 + minute` 得到一个结果，然后算右边的等号，就是把 `hour * 60 + minute` 的结果赋给变量 `total_minute`，这个结果同时也是整个表达式 `total_minute = hour * 60 + minute` 的值，再算左边的等号，即把这个值再赋给变量 `total`。

  同样优先级的运算符是从左到右计算还是从右到左计算称为运算符的结合性（Associativity）。`+` `-` `*` `/` 是左结合的，等号是右结合的。

### 目前语法规则 2.5

```
表达式 → 标识符
表达式 → 常量
表达式 → 字符串字面值
表达式 → (表达式)
表达式 → 表达式 + 表达式
表达式 → 表达式 - 表达式
表达式 → 表达式 * 表达式
表达式 → 表达式 / 表达式
表达式 → 表达式 = 表达式
语句 → 表达式;
语句 → printf(表达式, 表达式, 表达式, ...);
变量声明 → 类型 标识符 = Initializer, 标识符 = Initializer, ...;
（= Initializer的部分可以不写）
```

### 表达式、存储位置、值、左值、右值 2.5

- 赋值运算符左边的表达式不能是值 2.5

  根据语法规则组合出来的表达式在语义上并不总是正确的，例如：

  ``` c
  minute + 1 = hour;
  ```

  等号左边的表达式要求表示一个存储位置而不是一个值，这是赋值运算符和 `+` `-` `*` `/`运算符的又一个显著不同。

- 所有表达式都能表示值，只有一部位表达式能表示存储位置 2.5

  有的表达式既可以表示一个**存储位置**也可以表示一个**值**，而有的表达式只能表示值，不能表示存储位置，例如 `minute + 1` 这个表达式就不能表示存储位置，放在等号左边是语义错误。

- 能表示存储位置的表达式可以做左值，不能表示存储位置的表达式只能做右值 2.5

  表达式所表示的存储位置称为左值（lvalue）（允许放在等号左边），而以前我们所说的表达式的值也称为右值（rvalue）（只能放在等号右边）。

  上面的话换一种说法就是：有的表达式既可以做左值也可以做右值，而有的表达式只能做右值。

- 哪些表达式可以做左值 2.5

  目前我们学过的表达式中只有变量可以做左值，可以做左值的表达式还有几种，以后会讲到。
